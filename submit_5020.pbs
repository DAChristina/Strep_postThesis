#!/bin/bash

#PBS -N All_5000
#PBS -l walltime=70:00:00
#PBS -l select=1:ncpus=124:mem=300gb

# https://icl-rcs-user-guide.readthedocs.io/en/latest/hpc/pilot/cx3-phase2/#job-sizing-guidance

source ~/anaconda3/etc/profile.d/conda.sh

cd $PBS_O_WORKDIR
steps_folder=5020 # no space
conda run -n R_envConda Rscript "$HOME/Strep_postThesis/R/3_pmcmc.R" \
    --mode run_all \
    --n_particles 500 --n_steps "$steps_folder" \
    --run1_stochastic true --run2_stochastic false \
    --ncpus 124 \
    > "$HOME/Strep_postThesis/myresult.txt"

sleep 2
conda run -n R_envConda Rscript "$HOME/Strep_postThesis/R/4_post_pmcmc_pics.R" \
    --n_steps "$steps_folder"

sleep 2
conda run -n R_envConda Rscript "$HOME/Strep_postThesis/model/sir_stochastic_allAge_2post_pmcmc_picts.R" \
    --n_steps "$steps_folder"

printenv > "$HOME/Strep_postThesis/myenv.txt"
