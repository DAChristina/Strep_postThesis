---
title: "The Descriptive Analysis of IPD Caused by 12F"
author: "DAChristina"
output: html_document
date: "2024-12-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, echo = FALSE)

if(!require(pacman)) install.packages("pacman")
pacman::p_load(reactable, tidyverse, plotly)
```

## 1. Introduction

This report contains descriptive analysis and data visualisation for invasive pneumococcal disease (IPD) caused by Serotype 12F pneumococcus. The data was shared with me on 19 December 2024 and consists of information about the patient's age, sample type, sterility, and collection date.

There were 1,341 recorded cases from 2 January 2016 to 23 March 2022 dominated by adults and elderly people aged \>= 40 (see attached histogram below). The IPD cases peaked in 2018 (495 cases) and 2019 (365 cases) before slowly disappearing thereafter. 96.2% of the samples were dominated by blood culture (1290), and 98.7% of the samples were considered sterile.

```{r}
# 
options(dplyr.summarise.inform = FALSE) # supress annoying messages & warnings
dat <- read.csv("/home/ron/Strep_postThesis/inputs/data_12F_cleaned.csv") %>%
  dplyr::mutate(yearMonth = as.Date(yearMonth))

col_map <- c(
  # Vaccination
  "Pre-PCV7" = "lightblue",
  "PCV7" = "gray70",
  "PCV13" = "gray20",
  # 5 age bands 
  "<5" = "indianred4",
  "5-18" = "orange",
  "19-30" = "seagreen4",
  "31-64" = "steelblue",
  "65+" = "purple3",
  "Unknown" = "black",
  # 7 age bands
  "<2" = "indianred4", 
  "2-4" = "indianred2", 
  "5-14" = "orange",
  "15-30" = "seagreen1", # Edit the Age-band into 15-30 & 31-44
  "31-44" = "seagreen4", # Edit the Age-band into 15-30 & 31-44
  "45-64" = "steelblue",
  "65+" = "purple3",
  # 2 age bands
  "children" = "darkred",
  "adults" = "darkblue",
  # Regions (From north to south)
  "North West" = "indianred4",
  "North East" = "steelblue",
  "Yorkshire and The Humber" = "seagreen4",
  "East Midlands" = "purple3",
  "West Midlands" = "orange",
  "East of England" = "indianred2",
  "London" = "seagreen1",
  "South East" = "deepskyblue",
  "South West" = "gold1",
  # Cases vs sequenced
  "Serotype 1 Case" = "gray75",
  "Sequenced" = "deepskyblue3",
  "Meningitis" = "green",
  "30 Day Death" = "maroon"
)

table(dat$Sample.type)
hist(dat$Age)
```

## 

## 2. Data Visualisation

### 2.1. Seasonality

The case counts peaked in 2018 (495 cases) before slowly reducing in the following year (Figure 2.1.1. A). I grouped the data by months (Figure 2.1.1. B) and found that the case counts peaked in December (209 cases) before slightly reduced in January of the following year (159) but increased again in February (183 cases). The case counts hit its lowest case counts in August (only 43 cases recorded). The seasonality pattern was evident when I analysed the data specific to months in every year (Figure 2.1.1. C), with at least four peaks recorded in December (dashed red lines) but reduced in January and then increased again in February (red boxes covered December to March on the following year).

```{r}
all_year <- dat %>% 
  dplyr::group_by(year) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

all_month <- dat %>% 
  dplyr::group_by(month) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

# Generate new dataframe for yearMonth because no data in some yearMonth
all_yearMonth <- dplyr::left_join(
  data.frame(yearMonth = seq(as.Date(paste0(min(dat$year), "-01-01")),
                             as.Date(paste0(max(dat$year), "-12-01")),
                             by = "1 month"))
  ,
  dat %>% 
    dplyr::group_by(yearMonth) %>% 
    dplyr::summarise(counts = n()) %>% 
    dplyr::ungroup(),
  by = "yearMonth"
)

# Data viz!
viz_year <- ggplot(all_year, aes(x = year, y = counts)) +
  geom_line(size = 1.5) +
  scale_x_continuous(breaks = ~ axisTicks(., log = FALSE)) + # delete weird decimals in Year
  theme_bw()

viz_month <- ggplot(all_month, aes(x = month, y = counts)) +
  geom_line(size = 1.5) +
  scale_x_continuous(breaks = ~ axisTicks(., log = FALSE)) + # delete weird decimals in Year
  theme_bw()

# Additional data to viz seasonality pattern in yearMonth
december_lines <- seq(from = as.Date(paste0(min(dat$year)-1, "-12-01")),
                      to = as.Date(paste0(max(dat$year)-1, "-12-01")),
                      by = "1 year")


blocks <- data.frame(
  xmin = as.Date(paste0((min(dat$year) - 1):(max(dat$year) - 1), "-12-01")),  # Start December
  xmax = as.Date(paste0((min(dat$year)):(max(dat$year)), "-03-01")),  # End March
  year = (min(dat$year) - 1):(max(dat$year) - 1)
)

viz_yearMonth <- ggplot(all_yearMonth, aes(x = yearMonth, y = counts)) +
  geom_line(size = 1.5) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year", limits = c(as.Date("2015-12-01"), as.Date("2022-04-01"))) +
  geom_vline(xintercept = december_lines, linetype = "dashed", colour = "darkred") +
  geom_rect(data = blocks, aes(xmin = xmin, xmax = xmax,
                               ymin = -Inf, ymax = Inf),
            fill = "darkred",
            inherit.aes = FALSE, alpha = 0.3
  ) +
  ggtitle("The Counts of Serotype 12F by Months Specific to Every Year") +
  theme_bw() +
  theme(
    panel.grid.major = element_line(size = 0.2, color = "grey80"),
    panel.grid.minor = element_line(size = 0.2, color = "grey80"),
    axis.line = element_line(color = "black")
  )

p1 <- cowplot::plot_grid(viz_year, viz_month, labels = c("A", "B"))

# Annoying plot for label
cow_yearMonth <- cowplot::plot_grid(NULL, viz_yearMonth,
                                    ncol = 1,
                                    rel_heights = c(0.1, 2),
                                    labels = c("", "C"))

p2 <- cowplot::plot_grid(p1, cow_yearMonth,
                         ncol = 1,
                         rel_heights = c(0.75, 1))
p2
```

### 2.2. Age heterogeneity

Based on age heterogeneity stratification, the case counts of IPD in children are always lower than in adults (Figure 2.2.1.), with an overall consensus that adults aged more than 45 years and elderly population (65+ ) can be considered vulnerable (personal opinion), that might be related to the effectiveness of the polyvalent pneumococcal vaccine (PPV) and the vaccination coverage. I created a set of additional graphs for each month specific to years to inspect which age groups were infected first (then transmitted 12F to the other vulnerable groups).

```{r pressure, echo=FALSE}
ageGroup2_y <- dat %>% 
  dplyr::group_by(year, ageGroup2) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

ageGroup2_yM <- dat %>% 
  dplyr::group_by(yearMonth, ageGroup2) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

ageGroup5_y <- dat %>% 
  dplyr::group_by(year, ageGroup5) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

ageGroup5_yM <- dat %>% 
  dplyr::group_by(yearMonth, ageGroup5) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

ageGroup7_y <- dat %>% 
  dplyr::group_by(year, ageGroup7) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

ageGroup7_yM <- dat %>% 
  dplyr::group_by(yearMonth, ageGroup7) %>% 
  dplyr::summarise(counts = n()) %>% 
  dplyr::ungroup()

# Data viz!
viz_agegroup2_y <- ggplot(ageGroup2_y, aes(x = year, y = counts, group = ageGroup2,
                                           color = ageGroup2)) +
  geom_line(size = 1.5) +
  scale_color_manual(values = c(col_map),
                     name = "Demographic",
                     breaks = c("children", "adults"),
                     labels = c("Children (< 15)", "Adults")
  ) +
  scale_x_continuous(breaks = ~ axisTicks(., log = FALSE)) + # delete weird decimals in Year
  theme_bw() +
  theme(legend.position = "none")

viz_agegroup2_yM <- ggplot(ageGroup2_yM, aes(x = yearMonth, y = counts, group = ageGroup2,
                                             color = ageGroup2)) +
  geom_line(size = 1) +
  scale_color_manual(values = c(col_map),
                     name = "Demographic",
                     breaks = c("children", "adults"),
                     labels = c("Children (< 15)", "Adults")
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year", limits = c(as.Date("2015-12-01"), as.Date("2022-04-01"))) +
  theme_bw() +
  theme(
    legend.text = element_text(size=10),
    legend.title = element_text(size=11),
    legend.key.size = unit(0.25, "cm")
  )

viz_agegroup5_y <- ggplot(ageGroup5_y, aes(x = year, y = counts, group = ageGroup5,
                                           color = ageGroup5)) +
  geom_line(size = 1.5) +
  scale_color_manual(values = c(col_map),
                     name = "Demographic",
                     breaks = c("<5", "5-18", "19-30", "31-64", "65+", "Unknown"),
                     labels = c("<5", "5-18", "19-30", "31-64", "65+", "Unknown")
  ) +
  scale_x_continuous(breaks = ~ axisTicks(., log = FALSE)) + # delete weird decimals in Year
  theme_bw() +
  theme(legend.position = "none")

viz_agegroup5_yM <- ggplot(ageGroup5_yM, aes(x = yearMonth, y = counts, group = ageGroup5,
                                             color = ageGroup5)) +
  geom_line(size = 1) +
  scale_color_manual(values = c(col_map),
                     name = "Demographic",
                     breaks = c("<5", "5-18", "19-30", "31-64", "65+", "Unknown"),
                     labels = c("<5", "5-18", "19-30", "31-64", "65+", "Unknown")
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year", limits = c(as.Date("2015-12-01"), as.Date("2022-04-01"))) +
  theme_bw() +
  theme(
    legend.text = element_text(size=10),
    legend.title = element_text(size=11),
    legend.key.size = unit(0.25, "cm")
  )

viz_agegroup7_y <- ggplot(ageGroup7_y, aes(x = year, y = counts, group = ageGroup7,
                                           color = ageGroup7)) +
  geom_line(size = 1.5) +
  scale_color_manual(values = c(col_map),
                     name = "Demographic",
                     breaks = c("<2", "2-4", "5-14", "15-30", "31-44", "45-64", "65+", "Unknown"),
                     labels = c("<2", "2-4", "5-14", "15-30", "31-44", "45-64", "65+", "Unknown")
  ) +
  scale_x_continuous(breaks = ~ axisTicks(., log = FALSE)) + # delete weird decimals in Year
  theme_bw() +
  theme(legend.position = "none")

viz_agegroup7_yM <- ggplot(ageGroup7_yM, aes(x = yearMonth, y = counts, group = ageGroup7,
                                             color = ageGroup7)) +
  geom_line(size = 1) +
  scale_color_manual(values = c(col_map),
                     name = "Demographic",
                     breaks = c("<2", "2-4", "5-14", "15-30", "31-44", "45-64", "65+", "Unknown"),
                     labels = c("<2", "2-4", "5-14", "15-30", "31-44", "45-64", "65+", "Unknown")
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year", limits = c(as.Date("2015-12-01"), as.Date("2022-04-01"))) +
  theme_bw() +
  theme(
    legend.text = element_text(size=10),
    legend.title = element_text(size=11),
    legend.key.size = unit(0.25, "cm")
  )

p3_y <- cowplot::plot_grid(viz_agegroup2_y, viz_agegroup5_y, viz_agegroup7_y,
                           ncol = 1,
                           labels = c("A", "B", "C"))

p3_yM <- cowplot::plot_grid(viz_agegroup2_yM, viz_agegroup5_yM, viz_agegroup7_yM,
                            ncol = 1)

p3 <- cowplot::plot_grid(p3_y, p3_yM,
                         ncol = 2,
                         rel_widths = c(0.65, 1.25))
p3
```

## 3. Conclusions and Future Works

Serotype 12F, like any other (known) pneumococcal disease, follows a seasonality pattern and peaked in December before reducing again in January of the following year and then increasing again in February. Adults aged 45-64 followed by elderly populations (65+), are the most vulnerable age groups. Future works would benefit from analysing the incidence of serotype 12F (against a whole population in a known geographical area), including the vaccination coverage focused on adults.
